<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ZEWEIL Chat</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #chat {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #333;
      padding: 10px;
      margin-bottom: 10px;
    }
    .msg {
      margin-bottom: 5px;
      padding: 5px;
      background-color: #222;
      border-radius: 5px;
    }
    #typingIndicator {
      font-size: 14px;
      color: #888;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<h2>Ø´Ø§Øª Ø²ÙˆÙŠÙ„ ðŸ”¥</h2>

<div id="typingIndicator"></div>
<div id="chat"></div>

<input type="text" id="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." style="width: 80%;">
<button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>

<script>
  // Ø¨ÙŠØ§Ù†Ø§ØªÙƒ:
  const userName = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ:");
  const roomId = prompt("Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©:");

  // Ø¥Ø¹Ø¯Ø§Ø¯ ÙØ§ÙŠØ±Ø¨ÙŠØ²
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  const chatDiv = document.getElementById("chat");
  const messageInput = document.getElementById("message");

  // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  firebase.database().ref(`rooms/${roomId}/messages`).on("child_added", snapshot => {
    const data = snapshot.val();
    const div = document.createElement("div");
    div.classList.add("msg");
    div.textContent = `${data.name}: ${data.text}`;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  });

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  function sendMessage() {
    const msg = messageInput.value.trim();
    if (msg === "") return;
    firebase.database().ref(`rooms/${roomId}/messages`).push({
      name: userName,
      text: msg,
      timestamp: Date.now()
    });
    messageInput.value = "";
  }

  // "ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†" - Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø©
  let typingTimeout;
  messageInput.addEventListener("input", () => {
    clearTimeout(typingTimeout);
    firebase.database().ref(`rooms/${roomId}/typing/${userName}`).set(true);
    typingTimeout = setTimeout(() => {
      firebase.database().ref(`rooms/${roomId}/typing/${userName}`).set(false);
    }, 2000);
  });

  // "ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†" - Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©
  firebase.database().ref(`rooms/${roomId}/typing`).on("value", snapshot => {
    const typingUsers = [];
    snapshot.forEach(child => {
      if (child.val() === true && child.key !== userName) {
        typingUsers.push(child.key);
      }
    });
    const indicator = document.getElementById("typingIndicator");
    if (typingUsers.length > 0) {
      indicator.textContent = `${typingUsers.join(" Ùˆ ")} ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†...`;
    } else {
      indicator.textContent = "";
    }
  });
</script>

</body>
</html>
